<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è - OPAC-Global</title>
    <link rel="stylesheet" href="styles.css" id="main-style">
    <link rel="stylesheet" href="light-styles.css" id="light-theme" disabled>
	  <link rel="stylesheet" href="high-contrast.css">
  <link rel="stylesheet" href="grayscale.css">
    
</head>
<body>
    <div class="container">
        <nav class="sidebar" id="sidebar">
            <ul class="menu">
                <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="marking.html">–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞</a></li>
                <li><a href="inventory.html">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</a></li>
                <li><a href="personnel.html">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∏</a></li>
				<li><a href="setting.html">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
				<li> <a href="login.html">–í—ã—Ö–æ–¥</a></li>
				<li>
                    <button id="theme-toggle" class="theme-toggle">
                        <span class="theme-icon">üåì</span> –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É
                    </button>
                </li>
            </ul>
        </nav>
		
        <button class="menu-button" onclick="toggleMenu()">‚ò∞</button>
            
        <main class="content">
            <div class="header">
                <h1>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–¥–∞</h1>
                <p>–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ –∏–ª–∏ –≤–≤–æ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é —à—Ç—Ä–∏—Ö-–∫–æ–¥—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</p>
            </div>
            
            <div class="inventory-container">
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ -->
                <div class="inventory-info">
                    <p>–í—Å–µ–≥–æ –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: <span id="total-scanned">0</span> –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</p>
                </div>
                
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                <div class="scan-controls">
                    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
                    <div class="scan-mode-container">
                        <span class="scan-mode-label">–†–µ–∂–∏–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</span>
                        <label class="scan-mode-switch">
                            <input type="checkbox" id="auto-scan-toggle">
                            <span class="scan-mode-slider"></span>
                        </label>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                    <div class="action-buttons-container">
                        <button id="clear-button" class="clear-button">–û—á–∏—Å—Ç–∏—Ç—å</button>
                        <button id="export-button" class="print-button">–≠–∫—Å–ø–æ—Ä—Ç</button>
                    </div>
                </div>
                
                <!-- –°–µ—Ç–∫–∞ —Å –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏ -->
                <div class="numbers-grid" id="numbers-grid">
                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ -->
                </div>
                
                <!-- –ü–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ -->
                <div class="input-footer">
                    <input type="text" 
                           id="number-input" 
                           class="number-input" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤—Ä—É—á–Ω—É—é –∏–ª–∏ —Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ"
                           autofocus>
                    <button id="add-button" class="add-button">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <span class="counter"><span id="items-count">0</span> —à—Ç.</span>
                </div>
            </div>
        </main>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
    <div class="modal-overlay" id="export-modal">
        <div class="modal-content">
            <h3 class="modal-title">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
            <div class="modal-message">
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤:</p>
                <div style="margin-top: 15px;">
                    <label style="display: block; margin-bottom: 10px;">
                        <input type="radio" name="export-format" value="csv" checked> CSV (Excel)
                    </label>
                    <label style="display: block; margin-bottom: 10px;">
                        <input type="radio" name="export-format" value="txt"> –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
                    </label>
                    <label style="display: block;">
                        <input type="radio" name="export-format" value="json"> JSON
                    </label>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-button secondary" onclick="closeExportModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-button primary" onclick="exportData()">–≠–∫—Å–ø–æ—Ä—Ç</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç–∞ -->
   <div class="modal-overlay" id="duplicate-modal">
        <div class="modal-content">
            <h3 class="modal-title">–î—É–±–ª–∏–∫–∞—Ç —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞</h3>
            <div class="modal-message">
                <p>–®—Ç—Ä–∏—Ö-–∫–æ–¥ <strong id="duplicate-number"></strong> —É–∂–µ –±—ã–ª –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω —Ä–∞–Ω–µ–µ.</p>
                <p>–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ç–æ—Ç —à—Ç—Ä–∏—Ö-–∫–æ–¥ –≤ —Å–∏—Å—Ç–µ–º–µ?</p>
            </div>
            <div class="modal-actions">
                <button class="modal-button secondary" onclick="closeDuplicateModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-button primary" onclick="checkBarcode()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <script src="theme-switcher.js"></script>
	
    <script>
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        const scannedNumbers = new Set();
        const numbersGrid = document.getElementById('numbers-grid');
        const numberInput = document.getElementById('number-input');
        const addButton = document.getElementById('add-button');
        const clearButton = document.getElementById('clear-button');
        const exportButton = document.getElementById('export-button');
        const itemsCount = document.getElementById('items-count');
        const totalScanned = document.getElementById('total-scanned');
        const autoScanToggle = document.getElementById('auto-scan-toggle');
        const exportModal = document.getElementById('export-modal');
        const duplicateModal = document.getElementById('duplicate-modal');
        const duplicateNumberEl = document.getElementById('duplicate-number');
        
        // –¢–µ–∫—É—â–∏–π –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –Ω–æ–º–µ—Ä (–¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞)
        let duplicateNumber = '';
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–Ω—é
        function toggleMenu() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞
        function addNumber() {
            const number = numberInput.value.trim();
            
            if (!number) return;
            
            if (!scannedNumbers.has(number)) {
                scannedNumbers.add(number);
                renderNumberCard(number);
                updateCounters();
                numberInput.value = '';
                
                // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                if (autoScanToggle.checked) {
                    numberInput.focus();
                }
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥—É–±–ª–∏–∫–∞—Ç–∞
                duplicateNumber = number;
                duplicateNumberEl.textContent = number;
                openDuplicateModal();
            }
        }
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–∞
        function forceAddDuplicate() {
            if (duplicateNumber) {
                scannedNumbers.add(duplicateNumber);
                renderNumberCard(duplicateNumber);
                updateCounters();
                numberInput.value = '';
                closeDuplicateModal();
                
                if (autoScanToggle.checked) {
                    numberInput.focus();
                }
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–æ–º–µ—Ä–∞
     // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–æ–º–µ—Ä–∞
        function renderNumberCard(number) {
            const card = document.createElement('div');
            card.className = 'number-card';
            card.innerHTML = `
                <div>${number}</div>
                <button class="remove-number" onclick="removeNumber('${number}', event)">√ó</button>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
            card.addEventListener('click', function(e) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –±—ã–ª –Ω–µ –ø–æ –∫–Ω–æ–ø–∫–µ —É–¥–∞–ª–µ–Ω–∏—è
                if (!e.target.classList.contains('remove-number')) {
                    checkBarcodeInSystem(number);
                }
            });
            
            numbersGrid.appendChild(card);
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º–µ (–ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É)
        function checkBarcodeInSystem(barcode) {
            const encodedBarcode = encodeURIComponent(barcode);
            const checkUrl = `https://opac.rounb.ru/cgiopac/opacg/opac.exe?arg0=libr&arg1=12345&_searchstr=%2Fopacg%2Ffreesearch2.html%3Fiddb%3D1%26value%3DIN+${encodedBarcode}%27%27&TypeAccess=PayAccess`;
            window.open(checkUrl, '_blank');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ (—á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è)
        function removeNumber(number, event) {
            event.stopPropagation(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è
            scannedNumbers.delete(number);
            updateCounters();
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            numbersGrid.innerHTML = '';
            scannedNumbers.forEach(num => renderNumberCard(num));
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –Ω–æ–º–µ—Ä–æ–≤
        function clearAll() {
            if (scannedNumbers.size > 0 && confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫?')) {
                scannedNumbers.clear();
                numbersGrid.innerHTML = '';
                updateCounters();
                numberInput.focus();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
        function updateCounters() {
            itemsCount.textContent = scannedNumbers.size;
            totalScanned.textContent = scannedNumbers.size;
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
        function openExportModal() {
            if (scannedNumbers.size === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
                return;
            }
            exportModal.classList.add('active');
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
        function closeExportModal() {
            exportModal.classList.remove('active');
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç–∞
        function openDuplicateModal() {
            duplicateModal.classList.add('active');
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç–∞
        function closeDuplicateModal() {
            duplicateModal.classList.remove('active');
            numberInput.value = '';
            numberInput.focus();
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData() {
            const format = document.querySelector('input[name="export-format"]:checked').value;
            let content = '';
            let mimeType = '';
            let fileName = 'inventory_export_' + new Date().toISOString().slice(0, 10);
            
            switch(format) {
                case 'csv':
                    content = '–®—Ç—Ä–∏—Ö-–∫–æ–¥\n' + Array.from(scannedNumbers).join('\n');
                    mimeType = 'text/csv';
                    fileName += '.csv';
                    break;
                case 'txt':
                    content = Array.from(scannedNumbers).join('\n');
                    mimeType = 'text/plain';
                    fileName += '.txt';
                    break;
                case 'json':
                    content = JSON.stringify(Array.from(scannedNumbers), null, 2);
                    mimeType = 'application/json';
                    fileName += '.json';
                    break;
            }
            
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            closeExportModal();
        }
		
		 // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞
        function checkBarcode() {
            if (duplicateNumber) {
                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞
                const encodedBarcode = encodeURIComponent(duplicateNumber);
                const checkUrl = `https://opac.rounb.ru/cgiopac/opacg/opac.exe?arg0=libr&arg1=12345&_searchstr=%2Fopacg%2Ffreesearch2.html%3Fiddb%3D1%26value%3DIN+${encodedBarcode}%27%27&TypeAccess=PayAccess`;
                
				
				
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º URL –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
                window.open(checkUrl, '_blank');
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                closeDuplicateModal();
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å
                numberInput.value = '';
                numberInput.focus();
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        addButton.addEventListener('click', addNumber);
        clearButton.addEventListener('click', clearAll);
        exportButton.addEventListener('click', openExportModal);
        
        numberInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addNumber();
            }
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ (–µ—Å–ª–∏ —Å–∫–∞–Ω–µ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç Enter)
        numberInput.addEventListener('input', (e) => {
            if (autoScanToggle.checked && numberInput.value.includes('\n')) {
                const number = numberInput.value.replace('\n', '').trim();
                if (number) {
                    numberInput.value = number;
                    addNumber();
                }
            }
        });
        
        // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            numberInput.focus();
        });
    </script>
</body>
</html>