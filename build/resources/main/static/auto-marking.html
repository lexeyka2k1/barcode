<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ - OPAC-Global</title>
    <link rel="stylesheet" href="styles.css" id="main-style">
    <link rel="stylesheet" href="light-styles.css" id="light-theme" disabled>
	  <link rel="stylesheet" href="high-contrast.css">
  <link rel="stylesheet" href="grayscale.css">
  
</head>
<body>
    <div class="container">
        <nav class="sidebar" id="sidebar">
            <ul class="menu">
                <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="marking.html">–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞</a></li>
                <li><a href="inventory.html">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</a></li>
                <li><a href="personnel.html">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∏</a></li>
				<li><a href="setting.html">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
				<li> <a href="login.html">–í—ã—Ö–æ–¥</a></li>
				<li>
                    <button id="theme-toggle" class="theme-toggle">
                        <span class="theme-icon">üåì</span> –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É
                    </button>
                </li>
            </ul>
        </nav>
        
        <button class="menu-button" onclick="toggleMenu()">‚ò∞</button>
        
        <main class="content">
            <div class="header">
                <h1>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞</h1>
                <p>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤ –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º</p>
            </div>
            
            <div class="auto-marking-container">
               
                
                <div class="auto-form-container">
                    <form id="code">
                        <table class="auto-form-table">
                            <tr>
                                <td><label for="id">–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä:</label></td>
                                <td><input type="text" id="id" name="id" readonly></td>
                            </tr>
                            <tr>
                                <td><label for="kod1">–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:</label></td>
                                <td><input type="text" id="kod1" name="kod1" maxlength="6"></td>
                            </tr>
                            <tr>
                                <td><label for="kod2">–ö–æ–Ω–µ—á–Ω—ã–π –∫–æ–¥:</label></td>
                                <td><input type="text" id="kod2" name="kod2" maxlength="6"></td>
                            </tr>
                            <tr>
                                <td><label for="kol">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤:</label></td>
                                <td><input type="text" id="kol" name="kol" readonly></td>
                            </tr>
                            <tr>
                                <td><label for="kol_str">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü:</label></td>
                                <td><input type="text" id="kol_str" name="kol_str"></td>
                            </tr>
                        </table>
                        
                        <div class="auto-form-actions">
                            <button type="button" onclick="refreshPage()" class="auto-form-button secondary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                            <button type="button" onclick="printBarcodes()" class="auto-form-button primary">–ü–µ—á–∞—Ç—å —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script src="theme-switcher.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const institutionKey = localStorage.getItem('institutionKey');
    if (!institutionKey) {
        window.location.href = 'login.html';
        return;
    }

    // –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã
    const idField = document.getElementById('id');
    const kod1Field = document.getElementById('kod1');
    const kod2Field = document.getElementById('kod2');
    const kolField = document.getElementById('kol');
    const kolStrField = document.getElementById('kol_str');

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º ID —É—á—Ä–µ–∂–¥–µ–Ω–∏—è
    idField.value = institutionKey;

    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–ª–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const lastEndCode = localStorage.getItem('lastEndCode');
    const defaultStart = '000001';

    kod1Field.value = lastEndCode
        ? String(Number(lastEndCode) + 1).padStart(6, '0')
        : defaultStart;

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç
    const calculateFields = () => {
        const startNum = Number(kod1Field.value);
        const count = 28; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–¥–æ–≤
        const endNum = startNum + count - 1;

        kod2Field.value = String(endNum).padStart(6, '0');
        kolField.value = count;
        kolStrField.value = '1'; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ 1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    };

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    kod1Field.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/\D/g, '').slice(0, 6);
        calculateFields();
    });

    kolStrField.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/[^\d.]/g, '');
    });

    // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
    calculateFields();
});

function printBarcodes() {
    const institutionKey = localStorage.getItem('institutionKey');
    const startCode = document.getElementById('kod1').value;
    const count = 27;

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏
    const numbers = [];
    for (let i = 0; i < count; i++) {
        const num = Number(startCode) + i;
        const fullCode = institutionKey + String(num).padStart(7, '0');
        numbers.push(fullCode);
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
    localStorage.setItem('lastEndCode', String(Number(startCode) + count - 1));

    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–µ—á–∞—Ç–∏
    window.open(`print-preview.html?numbers=${encodeURIComponent(JSON.stringify(numbers))}`, '_blank');
}

function refreshPage() {
    window.location.reload();
}
    </script>
</body>
</html>