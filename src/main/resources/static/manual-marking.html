<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†—É—á–Ω–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ - OPAC-Global</title>
	
	
    <link rel="stylesheet" href="styles.css" id="main-style">
<link rel="stylesheet" href="light-styles.css" id="light-theme" disabled>
  <link rel="stylesheet" href="high-contrast.css">
  <link rel="stylesheet" href="grayscale.css">
</head>
<body>
    <div class="container">
       <nav class="sidebar" id="sidebar">
            <ul class="menu">
                <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="marking.html">–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞</a></li>
                <li><a href="inventory.html">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</a></li>
                <li><a href="personnel.html">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∏</a></li>
				<li><a href="setting.html">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
				<li> <a href="login.html">–í—ã—Ö–æ–¥</a></li>
				<li>
                    <button id="theme-toggle" class="theme-toggle">
                        <span class="theme-icon">üåì</span> –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É
                    </button>
                </li>
            </ul>
        </nav>
		
		 <button class="menu-button" onclick="toggleMenu()">‚ò∞</button>
	
		
        <main class="content">
            <div class="header">
                <h1>–†—É—á–Ω–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞</h1>
                <p>–í–≤–µ–¥–∏—Ç–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏</p>
            </div>
            
            <div class="manual-marking-container">
                <div class="action-buttons-container">
                    <button id="clear-button" class="clear-button">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
                    <button id="print-button" class="print-button">–ü–µ—á–∞—Ç—å</button>
                </div>
                
                <div id="warning" class="warning-message" style="display: none;">
                    –í–Ω–∏–º–∞–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω–æ –º–µ–Ω–µ–µ 28 –Ω–æ–º–µ—Ä–æ–≤. –ù–∞ –ª–∏—Å—Ç–µ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –ø—É—Å—Ç—ã–µ –º–µ—Å—Ç–∞.
                </div>
                
                <div id="numbers-grid" class="numbers-grid"></div>
                
                <div class="input-footer">
                    <input type="text" id="number-input" class="number-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–π –Ω–æ–º–µ—Ä">
                    <button id="add-button" class="add-button">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <div class="counter"><span id="count">0</span>/28</div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç–∞ -->
    <div id="duplicate-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="modal-title">–î—É–±–ª–∏–∫–∞—Ç –Ω–æ–º–µ—Ä–∞</h3>
            <p class="modal-message" id="duplicate-message">–≠—Ç–æ—Ç –Ω–æ–º–µ—Ä —É–∂–µ –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω —Ä–∞–Ω–µ–µ.</p>
            <div class="modal-actions">
                <button id="cancel-btn" class="modal-button secondary">–û—Ç–º–µ–Ω–∞</button>
                <button id="continue-btn" class="modal-button primary">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
	<script src="theme-switcher.js"></script>
	
    <script>
       document.addEventListener('DOMContentLoaded', function() {
    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã DOM
    const numberInput = document.getElementById('number-input');
    const addButton = document.getElementById('add-button');
    const clearButton = document.getElementById('clear-button');
    const printButton = document.getElementById('print-button');
    const numbersGrid = document.getElementById('numbers-grid');
    const warningElement = document.getElementById('warning');
    const countElement = document.getElementById('count');
    const duplicateModal = document.getElementById('duplicate-modal');
    const duplicateMessage = document.getElementById('duplicate-message');
    const continueBtn = document.getElementById('continue-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    
    // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤
    let numbers = [];
    // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞
    let duplicateNumber = '';
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –∏–∑ localStorage
    loadNumbers();
    
    // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    addButton.addEventListener('click', processInput);
    clearButton.addEventListener('click', clearAll);
    printButton.addEventListener('click', printNumbers);
    numberInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') processInput();
    });
    continueBtn.addEventListener('click', confirmDuplicate);
    cancelBtn.addEventListener('click', cancelDuplicate);
    
    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–≤–æ–¥–∞
    function processInput() {
        const number = numberInput.value.trim();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª–µ –Ω–µ –ø—É—Å—Ç–æ–µ
        if (!number) return;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç
        if (numbers.includes(number)) {
            showDuplicateModal(number);
            return;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä
        addNumber(number);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞
    function addNumber(number) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç
        if (numbers.length >= 28) {
            alert('–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–º–µ—Ä–æ–≤ (28)');
            return;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä –≤ –º–∞—Å—Å–∏–≤
        numbers.push(number);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º, –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        saveNumbers();
        renderNumbers();
        updateInterface();
        
        // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–∫—É—Å
        numberInput.value = '';
        numberInput.focus();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö –Ω–æ–º–µ—Ä–æ–≤
    function clearAll() {
        if (numbers.length === 0) return;
        
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –Ω–æ–º–µ—Ä–∞?')) {
            numbers = [];
            saveNumbers();
            renderNumbers();
            updateInterface();
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø–µ—á–∞—Ç–∏
     function printNumbers() {
        if (numbers.length === 0) {
            alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –Ω–æ–º–µ—Ä –¥–ª—è –ø–µ—á–∞—Ç–∏');
            return;
        }

        // –ü–æ–ª—É—á–∞–µ–º ID —É—á—Ä–µ–∂–¥–µ–Ω–∏—è
        const institutionKey = localStorage.getItem('institutionKey');
        if (!institutionKey) {
            alert('–û—à–∏–±–∫–∞: ID —É—á—Ä–µ–∂–¥–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }

        // –î–æ–±–∞–≤–ª—è–µ–º ID —É—á—Ä–µ–∂–¥–µ–Ω–∏—è –∫ –∫–∞–∂–¥–æ–º—É –Ω–æ–º–µ—Ä—É
        const numbersWithId = numbers.map(num => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ ID (–Ω–∞ —Å–ª—É—á–∞–π –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–µ—á–∞—Ç–∏)
            if (num.startsWith(institutionKey)) {
                return num;
            }
            return institutionKey + String(num).padStart(7, '0');
        });

        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–µ—á–∞—Ç–∏
        window.location.href = 'print-preview.html?numbers=' + encodeURIComponent(JSON.stringify(numbersWithId));
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –Ω–æ–º–µ—Ä–æ–≤
    function renderNumbers() {
        // –û—á–∏—â–∞–µ–º —Å–µ—Ç–∫—É
        numbersGrid.innerHTML = '';
        
        // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–º–µ—Ä–∞
        numbers.forEach((num, index) => {
            const card = document.createElement('div');
            card.className = 'number-card';
            card.innerHTML = `
                ${num}
                <button class="remove-number" data-index="${index}">
                    <span class="remove-icon">√ó</span>
                </button>
            `;
            numbersGrid.appendChild(card);
        });
        
        // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
        setupRemoveHandlers();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —É–¥–∞–ª–µ–Ω–∏—è
    function setupRemoveHandlers() {
        document.querySelectorAll('.remove-number').forEach(btn => {
            btn.addEventListener('click', function(e) {
                const index = parseInt(e.target.closest('button').getAttribute('data-index'));
                numbers.splice(index, 1);
                saveNumbers();
                renderNumbers();
                updateInterface();
            });
        });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç–∞
    function showDuplicateModal(number) {
        duplicateNumber = number;
        duplicateMessage.textContent = `–ù–æ–º–µ—Ä "${number}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å–ø–∏—Å–∫–µ.`;
        duplicateModal.classList.add('active');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–∞
    function confirmDuplicate() {
        duplicateModal.classList.remove('active');
        addNumber(duplicateNumber);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç–∞
    function cancelDuplicate() {
        duplicateModal.classList.remove('active');
        numberInput.value = duplicateNumber;
        numberInput.focus();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    function updateInterface() {
        updateCounter();
        updateWarning();
        updateAddButton();
        numberInput.focus();
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞
    function updateCounter() {
        countElement.textContent = numbers.length;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
    function updateWarning() {
        warningElement.style.display = (numbers.length > 0 && numbers.length < 28) ? 'block' : 'none';
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    function updateAddButton() {
        addButton.disabled = numbers.length >= 28;
    }
    
    // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–º–µ—Ä–æ–≤ –≤ localStorage
    function saveNumbers() {
        localStorage.setItem('manualMarkingNumbers', JSON.stringify(numbers));
    }
    
    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–º–µ—Ä–æ–≤ –∏–∑ localStorage
    function loadNumbers() {
        const saved = localStorage.getItem('manualMarkingNumbers');
        if (saved) {
            numbers = JSON.parse(saved);
            renderNumbers();
            updateInterface();
        }
    }
});

function toggleMenu() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('collapsed');
}
    </script>
	
	
</body>
</html>